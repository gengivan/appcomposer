{% set title = "Edit the app content" %}
{% set current_link = "home" %}
{% extends 'composers/adapt/layout.html' %}


    {% block styles %}           
        {{ super() }}
        <link rel="stylesheet" href="{{ url_for('static', filename='initializr/css/bootstrap-tagsinput.css') }}">                             
    {% endblock styles %}

    {% block body_content %}
        <div id="adaptblock">
            <div class="row">
                <div class="col-lg-12">
                    <div class="page-header">
                        <h1 id="apptitle">Adapt a guidance app - {{ adaptor_type }} - {{ name }} {{ n_rows }} </h1>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-12">                
                {% from "user/wl_form_helpers.html" import render_field %}

                {% with messages = get_flashed_messages() %}
                    {% for message in messages %}
                        <div class="alert alert-success">
                            <button type="button" class="close" data-dismiss="alert">×</button>
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endwith %}
                </div>                
            </div>            

            <div class="well">
                <div class="row">
                    <div class="col-lg-12"> 

                    {# Showing the main form by adaptor type #}

                    {# TODO: The content in the disabled tabs must be removed. Disabled tab != Content not available. #}
                    
                    {% if  adaptor_type == 'experiment_design' %}


                            
                        <!-- Tabs & Tables (WCAG 2.0 usability) for the EDT variables  
                        ================================================== --> 
                        
                        <div class="wrap">
                            <ul class="nav nav-tabs nav-justified" style="margin-bottom: 15px;">
                                <li class="active"><a href="#domain-one" data-toggle="tab">Domain - 1 of 2</a></li>
                                <li class="disabled"><a href="#domain-two" data-toggle="tab">Domain - 2 of 2</a></li>   
                                <li><a href="#experiment" data-toggle="tab">Experiment</a></li>                                                              
                                <li class="disabled"><a href="#preview" data-toggle="tab">Preview</a></li>
                            </ul>              
                            
                            <div id="tabadapt-tables" class="tab-content">                  
                                <div class="tab-pane fade active in" id="domain-one">
                                    <div class="col-lg-12">                                                                        

                                        <form class="form-horizontal" id="object-system-properties" action="." method="POST">                      

                                            <fieldset>
                                                <legend>Properties</legend> 

                                            <!-- Begin Table :: Object properties -->
                                            <div class="table-responsive">                                                                                              
                                                
                                                <table class="table table-striped table-hover">
                                                <caption>Object properties</caption>
                                                    
                                                <thead>
                                                    <tr>
                                                        <th>#</th>
                                                        <th>Name</th>
                                                        <th>Type</th>
                                                        <th>On?</th>                                        
                                                        <th>Symbol</th>
                                                        <th>Unit</th>
                                                        <th>Values</th>                              
                                                    </tr>
                                                </thead>
                                                    
                                                <tbody>
                                                        <tr id="row1">
                                                            <td id="col1"><span class="label label-default">1</span></td>
                                                            <td id="col2"><input type="text" name="name-1" id="" class="form-control" placeholder="mass"></td>
                                                            <td id="col3"><div class="checkbox"><input type="checkbox"></div></td>
                                                            <td id="col4"><div class="checkbox"><input type="checkbox"></div></td>                                             
                                                            <td id="col5"><input type="text" name="symbol-1" class="form-control" placeholder="m"></td>
                                                            <td id="col6"><input type="text" name="unit-1" class="form-control" placeholder="kg"></td>
                                                            <td id="col7"><input type="text" name="values-1" class="form-control" placeholder="*"></td>                               
                                                        </tr>
                                                        <tr id="row2">
                                                            <td><span class="label label-default">2</span></td>
                                                            <td><input type="text" name="name-2" id="" class="form-control" placeholder="volume"></td>
                                                            <td><div class="checkbox"><input type="checkbox"></div></td>
                                                            <td><div class="checkbox"><input type="checkbox"></div></td>                                              
                                                            <td><input type="text" name="symbol-2" class="form-control" placeholder="V"></td>
                                                            <td><input type="text" name="unit-2" class="form-control" placeholder="m^3"></td>
                                                            <td><input type="text" name="values-2" class="form-control" placeholder="*"></td>                            
                                                        </tr>                                                 
                                                                                                      
                                                </tbody>
                                                
                                                </table>


                      
                                            </div><!-- /endtable1 -->

                                            <!-- Begin Table :: System properties -->
                                            
                                            <!-- TO DO... -->

                                            </fieldset>
                                        
                                            
                                            <div class="form-group">
                                                <div class="col-lg-10 col-lg-offset-2">
                                                    <a class="btn btn-default" id="adaptcreate" href="#">« Go back to list </a> <!-- WE NEED TO BUILD WITH app_id or not show this at all or go to INDEX -->
                                                    <input type="hidden" name="app_id" value="{{ app_id }}">                                  
                                                    <input type="submit" value="Save properties" class="btn btn-success">  
                                                </div>
                                            </div>                                                                                          

                                        </form><!-- /form edt-tab1 --> 
                                        
                                    </div><!-- end collg-12 -->
                                </div><!-- /endtab1 -->
                        
                                <div class="tab-pane fade" id="domain-two">

                                    <form class="form-horizontal" id="object-relations-measures" action="#" method="POST">

                                    <!-- Second step of Domain editing- IF some_var exists then... ->
                                    <!-- Begin Table :: Object relations -->


                                    <div id="object-relations"  class="table-responsive">
                                        
                                        <table class="table table-striped table-hover">
                                        <caption>Object relations</caption>
                                            
                                        <thead>
                                            <tr>
                                                <th>#</th>
                                                <th>Variable name</th>
                                                <th>Relation</th>                              
                                            </tr>
                                        </thead>
                                            
                                        <tbody>
                                                <tr id="row1">
                                                    <td id="col1"><span class="label label-default">1</span></td>
                                                    <td><select class="form-control"><option>density</option><option>mass</option><option>volume</option></select></td>
                                                    <td id="col6"><input type="text" name="unit-1" class="form-control" placeholder="mass/volume"></td>                              
                                                </tr>
                                                <tr>
                                                    <td><span class="label label-default">2</span></td>
                                                    <td><input type="text" name="name-2" id="" class="form-control" placeholder="green"></td>
                                                    <td><input type="text" name="symbol-2" class="form-control" placeholder="blue+yellow"></td>                            
                                              </tr>
                                        </tbody>
                                        
                                        </table>
                                        
                                    </div><!-- /endtable3 -->

                                    <!-- Begin Table :: Object measures -->

                                    <div id="object-measures"  class="table-responsive">
                                        
                                        <table class="table table-striped table-hover">
                                        <caption>Object measures</caption>
                                            
                                        <thead>
                                            <tr>
                                                <th>#</th>
                                                <th>Name</th>
                                                <th>Type</th>
                                                <th>Unit</th>                              
                                                <th>Depends on</th>                                        
                                            </tr>
                                        </thead>
                                            
                                        <tbody>
                                                <tr id="row1">
                                                    <td id="col1"><span class="label label-default">1</span></td>                                           
                                                    <td id="col4"><input type="text" name="symbol-1" class="form-control" placeholder="m"></td>
                                                    <td id="col3"><div class="checkbox"><input type="checkbox"></div></td>                                             
                                                    <td id="col5"><input type="text" name="unit-1" class="form-control" placeholder="kg"></td>
                                                    <td id="col6"><input type="text" name="values-1" class="form-control" placeholder="*"></td>                              
                                                </tr>
                                                <tr>
                                                    <td><span class="label label-default">2</span></td>
                                                    <td><input type="text" name="name-2" id="" class="form-control" placeholder="volume"></td>
                                                    <td id="col3"><div class="checkbox"><input type="checkbox"></div></td>
                                                    <td><input type="text" name="unit-2" class="form-control" placeholder="m^3"></td>                            
                                                    <td><input type="text" name="unit-2" class="form-control" placeholder="m^3"></td>                                              
                                              </tr>
                                        </tbody>
                                        
                                        </table>
                                        
                                    </div><!-- /endtable4 -->
                                    
                                    <div class="form-group">
                                        <div class="col-lg-10 col-lg-offset-2">
                                            <a class="btn btn-default" id="adaptindex" href="#">« Go back to properties</a>
                                            <input type="hidden" name="app_id" value="{{ app_id }}">                                  
                                            <input type="submit" value="Save measures and relations" class="btn btn-success">  
                                        </div>
                                    </div>                                      


                                    </form><!-- /form edt-tab2 --> 
                                                                                                            
                                </div><!-- /endtab2 -->                          
                                

                                <div class="tab-pane fade" id="experiment">

                                    <form class="form-horizontal" id="object-properties-specs" action="#" method="POST">

                                    <!-- Third step : Editing the Experiment...  -->
                                    
                                    <fieldset>
                                        <legend>General</legend>                                        
                                        
                                        <div class="form-group">
                                            <label for="experiment_name" class="col-lg-2 control-label">Title:</label>
                                            <div class="col-lg-4">
                                                <input type="text" name="experiment_name"class="form-control"  value="">
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label for="experiment_description" class="col-lg-2 control-label">Description:</label>
                                            <div class="col-lg-4">
                                                <input type="text" name="experiment_description" class="form-control" value="">
                                            </div>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="associated_domain" class="col-lg-2 control-label">Associated domain:</label>
                                            <div class="col-lg-4">
                                                <select class="form-control" disabled=""><option>buoyancy</option></select>
                                            </div>
                                        </div>
                                    </fieldset>                                                                            

                                    <fieldset>
                                        <legend>Selections</legend>
                                        
                                        <div class="form-group">
                                            <label for="oproperties_selection" class="col-lg-2 control-label">Object properties:</label>
                                            <div class="col-lg-4">
                                                <select name="oproperties_selection" multiple="" class="form-control">
                                                    <option>mass</option>
                                                    <option>volume</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label for="measures_selection" class="col-lg-2 control-label">Object measures:</label>
                                            <div class="col-lg-4">
                                                <select name="measures_selection" multiple="" class="form-control">
                                                    <option>sink_or_float</option>
                                                    <option>water_displacement</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="sproperties_selection" class="col-lg-2 control-label">System properties:</label>
                                            <div class="col-lg-4">
                                                <select name="sproperties_selection" multiple="" class="form-control">
                                                    <option>fluid_aquarium</option>
                                                    <option>other</option>                                                
                                                </select>
                                            </div>
                                        </div>                                    
                                    </fieldset>

                                    <fieldset>
                                        <legend>Properties</legend>

                                    <!-- Begin Table :: Object property specifications -->
                                    <div id="object-specs"  class="table-responsive">
                                        
                                        <table class="table table-striped table-hover">
                                        <caption>Object property specifications</caption>
                                            
                                        <thead>
                                            <tr>
                                                <th>#</th>
                                                <th>Object property</th>
                                                <th>Unit</th>                                                
                                                <th>Initial</th>
                                                <th>Values</th>                                                                                                
                                                <th>Min</th>                                                
                                                <th>Max</th>                                                                             
                                            </tr>
                                        </thead>
                                           
                                        <tbody>
                                                <tr id="row1">
                                                    <td id="col1"><span class="label label-default">1</span></td>
                                                    <td><select class="form-control"><option>1</option><option>2</option><option>3</option></select></td>
                                                    <td id="col6"><input type="text" name="unit-1" class="form-control" placeholder="g"></td>                              
                                                    <td id="col6"><input type="text" name="unit-1" class="form-control" placeholder="d"></td> 
                                                    <td id="col6"><input type="text" name="unit-1" class="form-control" placeholder="r"></td> 
                                                    <td id="col6"><input type="text" name="unit-1" class="form-control" placeholder="g"></td> 
                                                    <td id="col6"><input type="text" name="unit-1" class="form-control" placeholder="r"></td>                                                                                                                                                                                                                 
                                                </tr>
                                                <tr>
                                                    <td><span class="label label-default">2</span></td>
                                                    <td><select class="form-control"><option>1</option><option>2</option><option>3</option></select></td>                                                    
                                                    <td><input type="text" name="name-2" id="" class="form-control" placeholder="p"></td>
                                                    <td><input type="text" name="symbol-2" class="form-control" placeholder="p"></td>
                                                    <td><input type="text" name="symbol-2" class="form-control" placeholder="p"></td>
                                                    <td><input type="text" name="symbol-2" class="form-control" placeholder="p"></td>
                                                    <td><input type="text" name="symbol-2" class="form-control" placeholder="p"></td>                                                                                                                                                                                        
                                              </tr>
                                        </tbody>
                                        
                                        </table>
                                        
                                    </div><!-- /endtable5 -->

                                    <!-- Begin Table :: System property values -->

                                    <div id="system-property-values"  class="table-responsive">
                                        
                                        <table class="table table-striped table-hover">
                                        <caption>System property values</caption>
                                            
                                        <thead>
                                            <tr>
                                                <th>#</th>
                                                <th>Property</th>
                                                <th>Value</th>                                        
                                            </tr>
                                        </thead>
                                            
                                        <tbody>
                                                <tr id="row1">
                                                    <td id="col1"><span class="label label-default">1</span></td>                                           
                                                    <td><select class="form-control"><option>1</option><option>2</option><option>3</option></select></td>                                              
                                                    <td id="col5"><input type="text" name="unit-1" class="form-control" placeholder="kg"></td>                            
                                                </tr>
                                                <tr>
                                                    <td><span class="label label-default">2</span></td>
                                                    <td><select class="form-control"><option>1</option><option>2</option><option>3</option></select></td> 
                                                    <td><input type="text" name="unit-2" class="form-control" placeholder="m^3"></td>                                                                        
                                              </tr>
                                        </tbody>
                                        
                                        </table>
                                        
                                    </div><!-- /endtable6 -->
                                    
                                    </fieldset>  

                                    <div class="form-group">
                                        <div class="col-lg-10 col-lg-offset-2">
                                            <a class="btn btn-default" id="adaptmeasures" href="#">« Go back to measures</a>
                                            <input type="hidden" name="app_id" value="{{ app_id }}">                                  
                                            <input type="submit" value="Save experiment" class="btn btn-success">  
                                        </div>
                                    </div>
                                            

                                    </form><!-- /form edt-tab3 --> 
                                                                                                            
                                </div><!-- /endtab3 -->                     
                                
                            </div><!-- /end tabs content-->                                        
                            
                        </div><!-- end wrap edt tables -->
                                                                                                                                
                    {% else %}

                        <!-- Tabs & Form for the Concept Mapper variables
                        ================================================== --> 

                        <div class="wrap">
                            <ul class="nav nav-tabs" style="margin-bottom: 15px;">
                                <li class="active"><a href="#edit" data-toggle="tab">Edit</a></li>
                                <li><a href="#preview" data-toggle="tab">Preview</a></li>
                            </ul>              
                            
                            <div id="tabadapt" class="tab-content">                  
                                <div class="tab-pane fade active in" id="edit">
                                    <div class="col-lg-10">
                                        
                                        <!--  
                                               * Concept mapper & Hypothesis tools: form input.  
                                               Variables to fill: domain = "concepts" of the concept mapper, and "elements" (conditionals+inputs/outputs) of the hypothesis tool, respectively.
                                        -->
                                        <form class="form-horizontal" method="POST" action=".">                                                                                                                                  

                                        {% if adaptor_type == 'concept_map' %}
                                        <!-- Block for the Concept map-->
                                            <div class="form-group">
                                                <label for="concepts" class="col-lg-2 control-label">Concepts:</label>
                                                <div class="col-lg-10">
                                                    <input type="text" name="concepts" value="{{ concepts|replace('[', '')|replace(']', '')|replace('"', '') }}" data-role="tagsinput">
                                                </div>
                                            </div>                                          
                                        {% endif %}                    

                                        {% if adaptor_type == 'hypothesis' %}
                                        <!-- The previous block and this one are used by the Hypothesis tool -->
                                            <div class="form-group">
                                                <label for="conditionals" class="col-lg-2 control-label">Conditionals:</label>
                                                <div class="col-lg-10">
                                                    <input type="text" name="conditionals" class="form-control" value="{{ conditionals|replace('[', '')|replace(']', '')|replace('"', '') }}" data-role="tagsinput">
                                                </div>
                                            </div>
                                            
                                            <div class="form-group">
                                                <label for="inputs" class="col-lg-2 control-label">Inputs:</label>
                                                <div class="col-lg-10">
                                                    <input type="text" name="inputs"  value="{{ inputs|replace('[', '')|replace(']', '')|replace("'", '') }}" data-role="tagsinput">
                                                </div>
                                            </div>
                                            
                                            <div class="form-group">
                                                <label for="outputs" class="col-lg-2 control-label">Outputs:</label>
                                                <div class="col-lg-10">
                                                    <input type="text" name="outputs"  value="{{ outputs|replace('[', '')|replace(']', '')|replace('"', '') }}" data-role="tagsinput">
                                                </div>
                                            </div>  
                                            {% endif %}

                                            <div class="form-group">
                                                <div class="col-lg-10 col-lg-offset-2">
                                                    <a class="btn btn-default" id="adaptindex" href="{{ url_for('adapt.adapt_index') }}">« Go back to adaptor index</a>
                                                    <input type="hidden" name="app_id" value="{{ app_id }}">                                  
                                                    <input type="submit" value="Save" class="btn btn-success"> 
                                                </div>
                                            </div>                                            
                                        </form>
                                        
                                    </div>
                                </div>
                        
                                <div class="tab-pane fade" id="preview">
                                   
                                  {# TODO: These URLs must be built outside the template. #} 
                                 {# TODO: Change the naming scheme of adaptor apps to avoid repeating these if/else structures. #}                                  
                                  {% if adaptor_type == 'concept_map' %}  
                                  <iframe src="http://localhost:5000/composers/adapt/export/{{ app_id }}/conceptmapper/conceptmapper.html" width="750" height="590" frameborder="1px solid gray" scrolling="no"></iframe>
                                  <div>
                                    <a href="http://localhost:5000/composers/adapt/export/{{ app_id }}/conceptmapper/app.xml">[+] Widget link</a>
                                  </div>
                                  {% elif adaptor_type == 'hypothesis' %}
                                  <iframe src="http://localhost:5000/composers/adapt/export/{{ app_id }}/hypothesis/hypothesis.html" width="750" height="590" frameborder="1px solid gray" scrolling="no"></iframe>
                                  <div>
                                    <a href="http://localhost:5000/composers/adapt/export/{{ app_id }}/hypothesis/app.xml">[+] Widget link</a>
                                  </div>                                  
                                  {% else %}
                                  <iframe src="http://localhost:5000/composers/adapt/export/{{ app_id }}/edt/edt.html" width="750" height="590" frameborder="1px solid gray" scrolling="no"></iframe>
                                  <div>
                                    <a href="http://localhost:5000/composers/adapt/export/{{ app_id }}/edt/app.xml">[+] Direct link for the app</a>
                                  </div>                                  
                                  {% endif %}
                                
                                  
                                </div>                        
                            </div>                                          
                        </div><!-- end wrap concept forms-->  


                    {% endif %}                                        

                                
                    </div>                    
                </div>                                
            </div>

        
    {% endblock %}

    {% block scripts %}
    {{ super() }}
    <script src="{{ url_for('static', filename='initializr/js/vendor/bootstrap-tagsinput.min.js') }}" type="text/javascript"></script>
    <script src="{{ url_for('static', filename='initializr/js/vendor/typeahead.min.js') }}" type="text/javascript"></script>
  
    {% endblock scripts %}
