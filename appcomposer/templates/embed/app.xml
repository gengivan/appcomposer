<Module>
 <ModulePrefs title="{{ app.name }}" height="{{ app.height + 20 }}">
    <Require feature="osapi" />
    {% if languages|length > 1 %}
    <AppComposerLanguages list="{{ ','.join(languages) }}"/>
    {% endif %}
 </ModulePrefs>
 <Content type="html" view="home,canvas">
 <![CDATA[
    <head>
    <style>
        #app_url {
        {# 9890 = 98.9% #}
        {% set max_width = 9890 %}
        {% if app.scale %}
            {% set new_scale = "scale(%s)" % (app.scale/max_width) %}
            -webkit-transform-origin: top left;
            -moz-transform-origin: top left;
            -ms-transform-origin: top left;
            -o-transform-origin: top left;
            transform-origin: top left;
            width: {{ max_width/(app.scale/100) }}%;
            -webkit-transform: {{ new_scale }};
            -moz-transform: {{ new_scale }};
            -ms-transform: {{ new_scale }};
            -o-transform: {{ new_scale }};
            transform: {{ new_scale }};
        {% else %}
            width: {{ max_width / 100 }}%;
        {% endif %}
        }
    </style>
    </head>

    <div style="width: 100%; overflow: hidden">
        <iframe id="app_url" {% if app.scale != 10000 %}scrolling="no"{% endif %} frameborder="0" {% if app.height %}height="{{ app.height }}px"{% else %}height="800px" {% endif %}></iframe>
    </div>

    <script type="text/javascript">
        function init() {
            var prefs = new gadgets.Prefs();
            var urls_per_language = {{ apps_per_language|tojson }};
            var default_url = {{ app.url|tojson }};
            var url = urls_per_language[prefs.getLang()];
            if (!url) 
                url = default_url;
            document.getElementById("app_url").src = url;
        }

        gadgets.util.registerOnLoadHandler(init);
    </script>
 ]]>
</Content>
</Module>
